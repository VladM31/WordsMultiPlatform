<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Words</title>
    <link rel="icon" type="image/webp" href="icon.webp">

    <!-- Preconnect for Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Noto Sans Symbols2 provides broader symbol coverage (arrow glyphs etc.) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Symbols2&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap"
          rel="stylesheet">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            box-sizing: border-box;
            /* Add symbol-supporting font as a fallback for web so characters like ⮕ and ⬅ render */
            font-family: 'Noto Sans Symbols2', 'Noto Sans JP', 'Noto Sans', 'Segoe UI Symbol', 'Segoe UI', system-ui, -apple-system, 'Segoe UI Emoji', 'Apple Color Emoji', sans-serif;
        }

        * {
            box-sizing: border-box;
        }
    </style>
    <!-- Initialize Firebase BEFORE composeApp loads -->
    <script>
        // Placeholder functions until Firebase loads
        window.logFirebaseEvent = function (eventName, params) {
            console.log('Firebase pending logEvent:', eventName, params);
            if (window._firebaseEventQueue) {
                window._firebaseEventQueue.push({type: 'event', eventName, params});
            }
        };
        window.setFirebaseUserId = function (userId) {
            console.log('Firebase pending setUserId:', userId);
            if (window._firebaseEventQueue) {
                window._firebaseEventQueue.push({type: 'userId', userId});
            }
        };
        window.setFirebaseUserProperty = function (name, value) {
            console.log('Firebase pending setUserProperty:', name, value);
            if (window._firebaseEventQueue) {
                window._firebaseEventQueue.push({type: 'property', name, value});
            }
        };
        window.logFirebaseScreenView = function (screenName, screenClass) {
            console.log('Firebase pending screen_view:', screenName, screenClass);
            if (window._firebaseEventQueue) {
                window._firebaseEventQueue.push({type: 'screen', screenName, screenClass});
            }
        };
        window._firebaseEventQueue = [];
    </script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import {initializeApp} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import {
            getAnalytics,
            logEvent,
            setUserId,
            setUserProperties
        } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAdiBvkaPLN_HHoRb4TxtE9jyp3lKnW4Ws",
            authDomain: "words-53d45.firebaseapp.com",
            projectId: "words-53d45",
            storageBucket: "words-53d45.firebasestorage.app",
            messagingSenderId: "1005445939198",
            appId: "1:1005445939198:web:d4405546c35cbf741c8aaf",
            measurementId: "G-53L6PK51VB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        console.log('Firebase Analytics initialized');

        // Replace placeholder functions with real implementations
        window.logFirebaseEvent = (eventName, params) => {
            try {
                console.log('Firebase logEvent:', eventName, params);
                logEvent(analytics, eventName, params || undefined);
            } catch (e) {
                console.warn('Firebase logEvent error:', e);
            }
        };
        window.setFirebaseUserId = (userId) => {
            try {
                console.log('Firebase setUserId:', userId);
                if (userId) setUserId(analytics, userId);
            } catch (e) {
                console.warn('Firebase setUserId error:', e);
            }
        };
        window.setFirebaseUserProperty = (name, value) => {
            try {
                console.log('Firebase setUserProperty:', name, value);
                setUserProperties(analytics, {[name]: value});
            } catch (e) {
                console.warn('Firebase setUserProperty error:', e);
            }
        };
        window.logFirebaseScreenView = (screenName, screenClass) => {
            try {
                console.log('Firebase screen_view:', screenName, screenClass);
                const params = {screen_name: screenName};
                if (screenClass) params.screen_class = screenClass;
                logEvent(analytics, 'screen_view', params);
            } catch (e) {
                console.warn('Firebase screen_view error:', e);
            }
        };

        // Process queued events
        if (window._firebaseEventQueue && window._firebaseEventQueue.length > 0) {
            console.log('Processing', window._firebaseEventQueue.length, 'queued Firebase events');
            window._firebaseEventQueue.forEach(item => {
                switch (item.type) {
                    case 'event':
                        window.logFirebaseEvent(item.eventName, item.params);
                        break;
                    case 'userId':
                        window.setFirebaseUserId(item.userId);
                        break;
                    case 'property':
                        window.setFirebaseUserProperty(item.name, item.value);
                        break;
                    case 'screen':
                        window.logFirebaseScreenView(item.screenName, item.screenClass);
                        break;
                }
            });
            window._firebaseEventQueue = null;
        }
    </script>
</head>
<body>
    <script src="composeApp.js"></script>
</body>
</html>
